<svg viewBox="0 0 820 620" width="820" height="620" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="a" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#94a3b8"/></marker>
    <filter id="s"><feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="#000" flood-opacity="0.06"/></filter>
  </defs>
  <rect width="820" height="620" rx="12" fill="#f8f9fb"/>

  <!-- Title -->
  <text x="410" y="32" text-anchor="middle" fill="#0e7490" font-family="Segoe UI,Helvetica,Arial,sans-serif" font-size="16" font-weight="700" letter-spacing="1.5">SGLANG ARCHITECTURE</text>
  <text x="410" y="50" text-anchor="middle" fill="#94a3b8" font-family="Segoe UI,sans-serif" font-size="11">Request flow: top → bottom</text>

  <!-- ═══ Incoming Request ═══ -->
  <rect x="295" y="68" width="230" height="38" rx="19" fill="#0e7490" filter="url(#s)"/>
  <text x="410" y="92" text-anchor="middle" fill="#fff" font-family="Segoe UI,sans-serif" font-size="13" font-weight="600">Incoming Request</text>
  <line x1="410" y1="106" x2="410" y2="130" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#a)"/>

  <!-- ═══ Layer 1: API + Frontend ═══ -->
  <rect x="60" y="136" width="700" height="72" rx="10" fill="#fff" stroke="#cbd5e1" stroke-width="1" filter="url(#s)"/>
  <text x="80" y="155" fill="#94a3b8" font-family="Consolas,monospace" font-size="9" letter-spacing="1">LAYER 1</text>
  <text x="410" y="164" text-anchor="middle" fill="#0e7490" font-family="Consolas,monospace" font-size="12" font-weight="700">API &amp; FRONTEND</text>
  <text x="170" y="190" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">OpenAI-compat API</text>
  <line x1="270" y1="175" x2="270" y2="200" stroke="#e2e8f0" stroke-width="1"/>
  <text x="370" y="190" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">gen() · select() · fork()</text>
  <line x1="480" y1="175" x2="480" y2="200" stroke="#e2e8f0" stroke-width="1"/>
  <text x="590" y="190" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Frontend DSL (Python)</text>
  <line x1="410" y1="208" x2="410" y2="232" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#a)"/>

  <!-- ═══ Layer 2: Router ═══ -->
  <rect x="60" y="238" width="700" height="64" rx="10" fill="#fff" stroke="#cbd5e1" stroke-width="1" filter="url(#s)"/>
  <text x="80" y="257" fill="#94a3b8" font-family="Consolas,monospace" font-size="9" letter-spacing="1">LAYER 2</text>
  <text x="410" y="266" text-anchor="middle" fill="#b45309" font-family="Consolas,monospace" font-size="12" font-weight="700">SGL-ROUTER  ·  Cache-Aware Load Balancer</text>
  <text x="410" y="290" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Rust-based · predicts per-worker cache hit rates · routes to highest-hit worker · 3.8× hit rate vs round-robin</text>
  <line x1="410" y1="302" x2="410" y2="326" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#a)"/>

  <!-- ═══ Layer 3: Scheduler ═══ -->
  <rect x="60" y="332" width="700" height="64" rx="10" fill="#fff" stroke="#cbd5e1" stroke-width="1" filter="url(#s)"/>
  <text x="80" y="351" fill="#94a3b8" font-family="Consolas,monospace" font-size="9" letter-spacing="1">LAYER 3</text>
  <text x="410" y="360" text-anchor="middle" fill="#0e7490" font-family="Consolas,monospace" font-size="12" font-weight="700">ZERO-OVERHEAD SCHEDULER</text>
  <text x="410" y="384" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Prepares next batch while GPU runs current batch · CPU work fully hidden · ~4K lines Python</text>
  <!-- Split arrows -->
  <line x1="310" y1="396" x2="310" y2="420" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#a)"/>
  <line x1="560" y1="396" x2="560" y2="420" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#a)"/>

  <!-- ═══ Layer 4a: RadixAttention ═══ -->
  <rect x="60" y="426" width="420" height="80" rx="10" fill="#fff" stroke="#cbd5e1" stroke-width="1" filter="url(#s)"/>
  <text x="80" y="445" fill="#94a3b8" font-family="Consolas,monospace" font-size="9" letter-spacing="1">LAYER 4a</text>
  <text x="270" y="454" text-anchor="middle" fill="#047857" font-family="Consolas,monospace" font-size="12" font-weight="700">RADIXATTENTION  ·  KV Cache Manager</text>
  <text x="270" y="476" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Radix tree stores KV tensors · auto prefix sharing · LRU eviction</text>
  <text x="270" y="496" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Content-addressable · paged GPU layout · zero-config caching</text>

  <!-- ═══ Layer 4b: xGrammar ═══ -->
  <rect x="500" y="426" width="260" height="80" rx="10" fill="#fff" stroke="#cbd5e1" stroke-width="1" filter="url(#s)"/>
  <text x="520" y="445" fill="#94a3b8" font-family="Consolas,monospace" font-size="9" letter-spacing="1">LAYER 4b</text>
  <text x="630" y="454" text-anchor="middle" fill="#6d28d9" font-family="Consolas,monospace" font-size="12" font-weight="700">XGRAMMAR</text>
  <text x="630" y="476" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Compressed FSM</text>
  <text x="630" y="496" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">Jump-forward decoding</text>

  <!-- Merge arrows -->
  <line x1="310" y1="506" x2="310" y2="522" stroke="#94a3b8" stroke-width="1.5"/>
  <line x1="560" y1="506" x2="560" y2="522" stroke="#94a3b8" stroke-width="1.5"/>
  <line x1="310" y1="522" x2="560" y2="522" stroke="#94a3b8" stroke-width="1.5"/>
  <line x1="410" y1="522" x2="410" y2="538" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#a)"/>

  <!-- ═══ Layer 5: GPU Workers ═══ -->
  <rect x="60" y="544" width="700" height="64" rx="10" fill="#fff" stroke="#cbd5e1" stroke-width="1" filter="url(#s)"/>
  <text x="80" y="563" fill="#94a3b8" font-family="Consolas,monospace" font-size="9" letter-spacing="1">LAYER 5</text>
  <text x="410" y="572" text-anchor="middle" fill="#c2410c" font-family="Consolas,monospace" font-size="12" font-weight="700">GPU WORKERS</text>
  <text x="410" y="596" text-anchor="middle" fill="#475569" font-family="Segoe UI,sans-serif" font-size="12">FlashInfer kernels · TP/DP/EP/PP · CUDA Graphs · chunked prefill · speculative decode · FP4/FP8/INT4/AWQ</text>
</svg>
